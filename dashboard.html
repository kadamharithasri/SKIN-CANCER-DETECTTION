<!DOCTYPE html>
<html>
<head>
<title>Skin Cancer Detection</title>

<style>
body{
    margin:0;
    font-family:'Segoe UI';
    background:#f4f4f4;
}

.navbar{
    background:#0f2027;
    color:white;
    padding:15px;
    text-align:center;
}

.container{
    width:90%;
    margin:30px auto;
    background:white;
    padding:30px;
    border-radius:12px;
}

/* Upload Block */
.upload-box{
    border:2px dashed #0f2027;
    padding:40px;
    text-align:center;
    cursor:pointer;
    border-radius:10px;
    color:#0f2027;
    font-weight:bold;
    transition:0.3s;
}

.upload-box:hover{
    background:#f0f8ff;
}

/* Preview Grid */
.preview-container{
    display:flex;
    flex-wrap:wrap;
    gap:15px;
    margin-top:20px;
}

.preview-item{
    position:relative;
}

.preview-item img{
    width:150px;
    height:150px;
    object-fit:cover;
    border-radius:8px;
}

.remove-btn{
    position:absolute;
    top:5px;
    right:5px;
    background:red;
    color:white;
    border:none;
    border-radius:50%;
    width:25px;
    height:25px;
    cursor:pointer;
}

.buttons{
    margin-top:20px;
    display:flex;
    gap:20px;
}

button{
    flex:1;
    padding:12px;
    border:none;
    background:#0f2027;
    color:white;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
}

button:hover{
    background:#203a43;
}

.summary{
    margin-top:30px;
    padding:15px;
    background:#e6f2ff;
    font-weight:bold;
}

.result-box{
    padding:10px;
    margin-top:5px;
    border-radius:6px;
}

.error{
    color:red;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="navbar">
<h2>Skin Cancer Detection System</h2>
</div>

<div class="container">

<form id="uploadForm" action="/predict" method="POST" enctype="multipart/form-data">

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" name="images" multiple hidden>

    <!-- Upload Block -->
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        Click Here To Upload Skin Images
    </div>

    <!-- Preview Section -->
    <div class="preview-container" id="previewContainer"></div>

    <!-- Buttons -->
    <div class="buttons">
        <button type="submit">Detect</button>
        <button type="button" onclick="clearImages()">Clear</button>
    </div>

</form>

<!-- Error -->
{% if error %}
<p class="error">{{ error }}</p>
{% endif %}

<!-- Results -->
{% if results %}

<div class="summary">
Total Images: {{ total_images }} <br>
ðŸŸ¥ Melanoma: {{ melanoma_count }} <br>
ðŸŸ§ Non-Melanoma: {{ non_melanoma_count }} <br>
ðŸŸ¢ No Cancer: {{ no_cancer_count }}
</div>

<h3>Individual Results:</h3>

{% for i in range(results|length) %}
<div style="margin-top:20px;">
    <img src="{{ image_paths[i] }}" width="200">

    {% if results[i] == "Melanoma" %}
        <div class="result-box" style="background:#ffcccc;color:#990000;">
            Melanoma Detected
        </div>

    {% elif results[i] == "Non-Melanoma" %}
        <div class="result-box" style="background:#ffe6cc;color:#cc6600;">
            Non-Melanoma Detected
        </div>

    {% else %}
        <div class="result-box" style="background:#ddffdd;color:#006600;">
            No Cancer Detected
        </div>
    {% endif %}
</div>
<hr>
{% endfor %}

{% endif %}

</div>

<script>

let selectedFiles = [];

// When files selected
document.getElementById("fileInput").addEventListener("change", function(event){

    const files = Array.from(event.target.files);

    files.forEach(file => {
        selectedFiles.push(file);
    });

    displayImages();
});

// Display preview
function displayImages(){

    const container = document.getElementById("previewContainer");
    container.innerHTML = "";

    selectedFiles.forEach((file, index) => {

        const reader = new FileReader();

        reader.onload = function(e){

            const div = document.createElement("div");
            div.classList.add("preview-item");

            div.innerHTML = `
                <img src="${e.target.result}">
                <button type="button" class="remove-btn" onclick="removeImage(${index})">Ã—</button>
            `;

            container.appendChild(div);
        };

        reader.readAsDataURL(file);
    });

    updateFileInput();
}

// Remove image
function removeImage(index){
    selectedFiles.splice(index,1);
    displayImages();
}

// Clear all
function clearImages(){
    selectedFiles = [];
    displayImages();
}

// Update hidden file input
function updateFileInput(){

    const dataTransfer = new DataTransfer();

    selectedFiles.forEach(file => {
        dataTransfer.items.add(file);
    });

    document.getElementById("fileInput").files = dataTransfer.files;
}

</script>

</body>
</html>